(window.webpackJsonp=window.webpackJsonp||[]).push([[27],{"H/lT":function(t,e,n){"use strict";n.r(e),n.d(e,"FeedchatPageModule",function(){return v});var s=n("ofXK"),i=n("3Pt+"),o=n("TEn/"),r=n("tyNb"),a=n("mrSG"),c=n("JZFu"),l=n("IBG6"),d=n("fXoL"),h=n("Jgta"),b=n("eIep"),m=n("lJxs"),u=n("UbJi"),g=n("I/3d");let f=(()=>{class t{constructor(t,e){this.afAuth=t,this.afs=e,this.currentUser=null,this.afAuth.onAuthStateChanged(t=>{this.currentUser=t}),this.getCurrentUser()}signup({email:t,password:e}){return Object(a.b)(this,void 0,void 0,function*(){const n=yield this.afAuth.createUserWithEmailAndPassword(t,e),s=n.user.uid;return this.afs.doc(`users/${s}`).set({uid:s,email:n.user.email})})}signIn({email:t,password:e}){return this.afAuth.signInWithEmailAndPassword(t,e)}signOut(){return this.afAuth.signOut()}addChatMessage(t,e){return this.afs.collection("feedchats").doc(e).collection("messages").add({msg:t,from:this.currentUser.uid,createdAt:h.a.firestore.FieldValue.serverTimestamp(),name:this.name,surname:this.surname,image:this.image,userid:this.currentUser.uid})}getChatMessages(t){let e=[];return this.getUsers().pipe(Object(b.a)(n=>(e=n,this.afs.collection("feedchats").doc(t).collection("messages",t=>t.orderBy("createdAt")).valueChanges({idField:"id"}))),Object(m.a)(t=>{for(let n of t)n.fromName=this.getUserForMsg(n.from,e),n.myMsg=this.currentUser.uid===n.from;return t}))}getUsers(){return this.afs.collection("users").valueChanges({idField:"uid"})}getCurrentUser(){h.a.firestore().collection("users").doc(h.a.auth().currentUser.uid).onSnapshot(t=>{this.name=t.data().username,this.surname=t.data().surnamez,this.image=t.data().image})}getUserForMsg(t,e){for(let n of e)if(n.uid==t)return n.email;return"Deleted"}}return t.\u0275fac=function(e){return new(e||t)(d.Ub(u.a),d.Ub(g.a))},t.\u0275prov=d.Hb({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();function p(t,e){if(1&t&&(d.Qb(0,"ion-title"),d.rc(1),d.Pb()),2&t){const t=e.$implicit;d.Bb(1),d.uc("",t.name," ",t.surname,"'s Post")}}function P(t,e){if(1&t){const t=d.Rb();d.Qb(0,"ion-card",13),d.Qb(1,"ion-item",14),d.Qb(2,"ion-avatar",15),d.Qb(3,"img",16),d.Yb("click",function(){d.nc(t);const n=e.$implicit;return d.ac().openPreview(n.image)}),d.Pb(),d.Pb(),d.Qb(4,"ion-label",0),d.rc(5),d.Qb(6,"p",5),d.rc(7),d.Pb(),d.Pb(),d.Pb(),d.Qb(8,"ion-card-content",17),d.Qb(9,"img",16),d.Yb("click",function(){d.nc(t);const n=e.$implicit;return d.ac().openPreview(n.pic)}),d.Pb(),d.Mb(10,"br"),d.Qb(11,"ion-card-title",18),d.rc(12),d.Pb(),d.Pb(),d.Pb()}if(2&t){const t=e.$implicit;d.Bb(3),d.ic("src",t.image,d.oc),d.Bb(2),d.uc(" ",t.name," ",t.surname," "),d.Bb(2),d.sc(t.date),d.Bb(2),d.ic("src",t.pic,d.oc),d.Bb(3),d.tc('"',t.comment,'"')}}const M=function(t,e){return{"my-message":t,"other-message":e}};function C(t,e){if(1&t&&(d.Qb(0,"ion-row"),d.Qb(1,"ion-col",19),d.Qb(2,"b"),d.rc(3),d.Pb(),d.Mb(4,"br"),d.Qb(5,"span"),d.rc(6),d.Pb(),d.Qb(7,"div",20),d.Mb(8,"br"),d.rc(9),d.bc(10,"date"),d.Pb(),d.Pb(),d.Pb()),2&t){const t=e.$implicit;d.Bb(1),d.hc("offset",t.myMsg?3:0)("ngClass",d.lc(9,M,t.myMsg,!t.myMsg)),d.Bb(2),d.uc("",t.name," ",t.surname,""),d.Bb(3),d.tc("",t.msg," "),d.Bb(3),d.sc(d.dc(10,6,null==t.createdAt?null:t.createdAt.toMillis(),"short"))}}const w=[{path:"",component:(()=>{class t{constructor(t,e,n,s,i,o,r){this.chatService=t,this.router=e,this.activatedRoute=n,this.modalController=s,this.Alert=i,this.loadingController=o,this.menuCtrt=r,this.db=c.a.firestore(),this.storage=c.a.storage().ref(),this.userID=c.a.auth().currentUser.uid,this.newMsg="",this.post=[],this.commentsNumber=[],this.msgCost=1,this.id=this.activatedRoute.snapshot.paramMap.get("id"),this.getFeedPost(this.id),this.myUserWallet()}ngOnInit(){this.messages=this.chatService.getChatMessages(this.id)}sendMsg(){this.senttcfcoin<1?(this.ErrorMessage="You dont have any coins left. Please reload.",this.presentAlert(this.ErrorMessage)):this.senttcfcoin>1&&this.CalculateCoin()}CalculateCoin(){this.myCoin=this.senttcfcoin-1,this.updateMyCoin()}updateMyCoin(){this.db.collection("tcfwallet").doc(this.userID).update({tcfcoin:this.myCoin}),this.sendMessage()}sendMessage(){this.chatService.addChatMessage(this.newMsg,this.id).then(()=>{this.newMsg="",this.content.scrollToBottom()})}myUserWallet(){this.db.collection("tcfwallet").doc(this.userID).onSnapshot(t=>{this.senttcfid=t.data().tcfid,this.senttcfcoin=t.data().tcfcoin})}getFeedPost(t){this.db.collection("feedwall").doc(t).onSnapshot(e=>{this.post=[],this.post.push(e.data()),console.log(this.post),this.comments=e.data().comments,this.getFeedCommentNumber(t)})}getFeedCommentNumber(t){this.commentsNumber=[],this.db.collection("feedchats").doc(t).collection("messages").onSnapshot(e=>{e.forEach(e=>{this.commentsNumber.push(e.data()),this.commentsNo=this.commentsNumber.length,setTimeout(()=>{this.updateCommentNo(t)},1)})})}updateCommentNo(t){this.db.collection("feedwall").doc(t).update({commentNo:this.commentsNo})}signOut(){this.chatService.signOut().then(()=>{})}getUser(){this.db.collection("users").doc(c.a.auth().currentUser.uid).onSnapshot(t=>{this.name=t.data().username,this.surname=t.data().surnamez})}openPreview(t){this.modalController.create({component:l.a,componentProps:{image:t}}).then(t=>t.present())}presentAlert(t){return Object(a.b)(this,void 0,void 0,function*(){const e=yield this.Alert.create({header:"Eish",message:t,buttons:["OK"]});yield e.present()})}goToFeedWall(){return Object(a.b)(this,void 0,void 0,function*(){const t=yield this.loadingController.create();yield t.present().then(()=>{this.menuCtrt.close().then(()=>{this.router.navigateByUrl("/tabs/feedwall").then(()=>Object(a.b)(this,void 0,void 0,function*(){yield t.dismiss()}))})})})}}return t.\u0275fac=function(e){return new(e||t)(d.Lb(f),d.Lb(r.g),d.Lb(r.a),d.Lb(o.ab),d.Lb(o.b),d.Lb(o.Y),d.Lb(o.Z))},t.\u0275cmp=d.Fb({type:t,selectors:[["app-feedchat"]],viewQuery:function(t,e){if(1&t&&d.vc(o.n,1),2&t){let t;d.mc(t=d.Zb())&&(e.content=t.first)}},decls:21,vars:7,consts:[["color","primary"],["name","arrow-back","vertical","end","slot","start",2,"margin-left","10px",3,"click"],[4,"ngFor","ngForOf"],[1,"ion-padding"],["style","align-content: center;",4,"ngFor","ngForOf"],[1,"p"],["color","light"],[1,"ion-align-items-center"],["size","10"],["autoGrow","true","rows","1","maxLength","500",1,"message-input",3,"ngModel","ngModelChange"],["size","2"],["expand","block","fill","clear","color","primary",1,"msg-btn",3,"disabled","click"],["name","send","slot","icon-only"],[2,"align-content","center"],["lines","none"],["slot","start"],["tappable","",3,"src","click"],[1,"align"],["color","primary",1,"align"],["size","9",1,"message",3,"offset","ngClass"],[1,"time","ion-text-right"]],template:function(t,e){1&t&&(d.Qb(0,"ion-header"),d.Qb(1,"ion-toolbar",0),d.Qb(2,"ion-icon",1),d.Yb("click",function(){return e.goToFeedWall()}),d.Pb(),d.qc(3,p,2,2,"ion-title",2),d.Pb(),d.Pb(),d.Qb(4,"ion-content",3),d.qc(5,P,13,6,"ion-card",4),d.Qb(6,"ion-item"),d.Qb(7,"ion-label",0),d.Qb(8,"p",5),d.rc(9,"Feed Comments"),d.Pb(),d.Pb(),d.Pb(),d.Qb(10,"ion-grid"),d.qc(11,C,11,12,"ion-row",2),d.bc(12,"async"),d.Pb(),d.Pb(),d.Qb(13,"ion-footer"),d.Qb(14,"ion-toolbar",6),d.Qb(15,"ion-row",7),d.Qb(16,"ion-col",8),d.Qb(17,"ion-textarea",9),d.Yb("ngModelChange",function(t){return e.newMsg=t}),d.Pb(),d.Pb(),d.Qb(18,"ion-col",10),d.Qb(19,"ion-button",11),d.Yb("click",function(){return e.sendMessage()}),d.Mb(20,"ion-icon",12),d.Pb(),d.Pb(),d.Pb(),d.Pb(),d.Pb()),2&t&&(d.Bb(3),d.hc("ngForOf",e.post),d.Bb(2),d.hc("ngForOf",e.post),d.Bb(6),d.hc("ngForOf",d.cc(12,5,e.messages)),d.Bb(6),d.hc("ngModel",e.newMsg),d.Bb(2),d.hc("disabled",""===e.newMsg))},directives:[o.s,o.V,o.t,s.k,o.n,o.y,o.A,o.r,o.q,o.H,o.m,o.S,o.fb,i.i,i.k,o.f,o.U,o.h,o.e,o.i,o.l,s.j],pipes:[s.b,s.e],styles:[".message-input[_ngcontent-%COMP%]{width:100%;border:1px solid var(--ion-color-medium);border-radius:6px;background:#4c8fa3;resize:none;margin-top:0;--padding-start:8px}.message[_ngcontent-%COMP%]{padding:10px!important;border-radius:10px!important;margin-bottom:4px!important;white-space:pre-wrap}.my-message[_ngcontent-%COMP%]{background:var(--ion-color-tertiary);color:#fff}.other-message[_ngcontent-%COMP%]{background:var(--ion-color-secondary);color:#fff}.time[_ngcontent-%COMP%]{color:#dfdfdf;float:right;font-size:small}.align[_ngcontent-%COMP%]{align-content:center;text-align:center;margin:auto;padding-top:6px}.align[_ngcontent-%COMP%]   .img[_ngcontent-%COMP%]{max-width:100%!important;max-height:100%!important}"]}),t})()}];let y=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=d.Jb({type:t}),t.\u0275inj=d.Ib({imports:[[r.k.forChild(w)],r.k]}),t})(),v=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=d.Jb({type:t}),t.\u0275inj=d.Ib({imports:[[s.c,i.e,o.W,y]]}),t})()}}]);